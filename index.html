<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tableau de Paraboles</title>
<style>
    #jsonOutput {
            width: 100%;
            height: 200px;
    }
    table {
        border-collapse:collapse ;
        width:95%;
        margin: 0 0 0 70px; /* Centrer horizontalement */
        border: 1px solid rgb(214, 214, 214);
        padding: 8px;
        text-align: left;
    }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h2>Apocalypse</h2>
<p>
    <i>
    Ici un petit r√©capitulatif des paraboles que l‚Äôon retrouve durant les cours sur les chapitres de l‚ÄôApocalypse. N‚Äôh√©sitez pas √† ajouter votre pierre √† l‚Äô√©difice üôèüèæ
    </i>
</p>

<table class="paraTable" >
    <thead>
        <tr>
            <th>Parabole</th>
            <th>Signification</th>
            <th>Versets</th>
            <th>bouton</th>
        </tr>
    </thead>
    <tbody id="table-body">
        <tr>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td contenteditable="true"></td>
            <td><button class="delete-button" onclick="supprimerLigne(this)">‚ùå</button></td>
        </tr>
    </tbody>
</table>

<button id="ajouter-ligne-btn" onclick="ajouterLigne()">Ajouter une ligne</button>

<script>
    const JSONBIN_URL = 'https://api.jsonbin.io/v3/b/664ca084ad19ca34f86ce956';
    const JSONBIN_API_KEY = '$2a$10$DHNAnAemgw/9O9GAoUu1D.sJe5WCn8YsoLQiyWLP1V31e2JsR8W/y';

    document.addEventListener("DOMContentLoaded", function() {
        chargerTableau();

        document.getElementById("table-body").addEventListener('input', function(event) {
            if (!event.isTrusted) return;
            sauvegarderTableau();
        });
    });

    function ajouterLigne() {
        var tableau = document.getElementById("table-body");
        var nouvelleLigne = tableau.insertRow();
        for (var i = 0; i < 3; i++) {
            var cellule = nouvelleLigne.insertCell(i);
            cellule.contentEditable = "true";
        }
        var celluleSupprimer = nouvelleLigne.insertCell(3);
        var boutonSupprimer = document.createElement("button");
        boutonSupprimer.className = "delete-button";
        boutonSupprimer.textContent = "‚ùå";
        boutonSupprimer.onclick = function() {
            supprimerLigne(this);
        };
        celluleSupprimer.appendChild(boutonSupprimer);
        sauvegarderTableau();
    }

    function supprimerLigne(bouton) {
        var ligneASupprimer = bouton.parentNode.parentNode;
        ligneASupprimer.parentNode.removeChild(ligneASupprimer);
        sauvegarderTableau();
    }

    function sauvegarderTableau() {
        var tableau = document.getElementById("table-body");
        var data = [];
        for (var i = 0; i < tableau.rows.length; i++) {
            var row = tableau.rows[i];
            var rowData = [];
            for (var j = 0; j < row.cells.length - 1; j++) {
                rowData.push(row.cells[j].innerText);
            }
            data.push(rowData);
        }

        var req = new XMLHttpRequest();
        req.onreadystatechange = function() {
            if (req.readyState == XMLHttpRequest.DONE) {
                console.log(req.responseText);
            }
        };

        req.open("PUT", JSONBIN_URL, true);
        req.setRequestHeader("Content-Type", "application/json");
        req.setRequestHeader("X-Master-Key", JSONBIN_API_KEY);
        req.send(JSON.stringify({ tableData: data }));
    }

    function chargerTableau() {
        var req = new XMLHttpRequest();
        req.onreadystatechange = function() {
            if (req.readyState == XMLHttpRequest.DONE) {
                if (req.status == 200) {
                    var response = JSON.parse(req.responseText);
                    var data = response.record.tableData || [];
                    var tableau = document.getElementById("table-body");
                    tableau.innerHTML = ''; // Clear existing rows
                    for (var i = 0; i < data.length; i++) {
                        var nouvelleLigne = tableau.insertRow();
                        for (var j = 0; j < data[i].length; j++) {
                            var cellule = nouvelleLigne.insertCell(j);
                            cellule.contentEditable = "true";
                            cellule.innerText = data[i][j];
                        }
                        var celluleSupprimer = nouvelleLigne.insertCell(data[i].length);
                        var boutonSupprimer = document.createElement("button");
                        boutonSupprimer.className = "delete-button";
                        boutonSupprimer.textContent = "‚ùå";
                        boutonSupprimer.onclick = function() {
                            supprimerLigne(this);
                        };
                        celluleSupprimer.appendChild(boutonSupprimer);
                    }
                } else {
                    console.log('Erreur lors du chargement', req.statusText);
                }
            }
        };

        req.open("GET", JSONBIN_URL + '/latest', true);
        req.setRequestHeader("X-Master-Key", JSONBIN_API_KEY);
        req.send();
    }
</script>

</body>
</html>
